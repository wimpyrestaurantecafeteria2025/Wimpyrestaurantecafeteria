<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wimpy - Pedidos y Confirmaci√≥n</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçî</text></svg>">
  <style>
    @media print {
      body * { visibility: hidden; }
      #cuenta-cobro, #cuenta-cobro * { visibility: visible; }
      #cuenta-cobro { position: absolute; left: 0; top: 0; }
    }
  </style>
</head>
<body class="antialiased">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // =========================================
    // CONFIG (poner aqu√≠ el URL de tu Apps Script)
    // =========================================
    const GOOGLE_SHEETS_API = 'https://script.google.com/macros/s/AKfycbwvbXwdh3xtkbHWsfwDTJ7BNU5A2fwIAWrGZ40j8w2UyzJeKh_lfQ6zcasIDqPOoSSYPQ/exec';
    // Valor por defecto (ser√° sobreescrito por la configuraci√≥n del Sheets al cargar)
    const DEFAULT_NUMERO_WIMPY = '573118336562';

    // =========================================
    // APP
    // =========================================
    function App() {
      // vistas generales
      const [vista, setVista] = useState('inicio'); // inicio | confirmacion | resultado | admin
      const [telefono, setTelefono] = useState('');
      const [clienteValidado, setClienteValidado] = useState(null);
      const [cargando, setCargando] = useState(false);
      const [cargandoDatos, setCargandoDatos] = useState(true);

      // admin
      const [autenticado, setAutenticado] = useState(false);
      const [passwordInput, setPasswordInput] = useState('');
      const ADMIN_PASSWORD = 'wimpy2025';
      const [vistaAdmin, setVistaAdmin] = useState('dashboard'); // dashboard | configuracion | clientes | productos | pedidos | reportes | factura

      // datos persistentes (tra√≠dos desde Google Sheets)
      const [CONFIG, setCONFIG] = useState({ numero_wimpy: DEFAULT_NUMERO_WIMPY });
      const [CLIENTES_DB, setCLIENTES_DB] = useState([]);
      const [HISTORIAL, setHISTORIAL] = useState([]);
      const [PRODUCTOS_DB, setPRODUCTOS_DB] = useState([]);
      const [PEDIDOS_DB, setPEDIDOS_DB] = useState([]);

      // productos / carrito
      const [nuevoProducto, setNuevoProducto] = useState({ nombre: '', precio: '' });
      const [editProductoId, setEditProductoId] = useState(null);
      const [carrito, setCarrito] = useState([]);

      // facturaci√≥n (mantengo tu estructura)
      const [datosFactura, setDatosFactura] = useState({
        numeroFactura: '',
        empresaCliente: '',
        mesFactura: new Date().getMonth(),
        anioFactura: new Date().getFullYear(),
        valorAlmuerzo: '',
        fechaEmision: new Date().toISOString().split('T')[0]
      });

      // filtros de reportes
      const [filtroMes, setFiltroMes] = useState(new Date().getMonth());
      const [filtroAnio, setFiltroAnio] = useState(new Date().getFullYear());
      const [filtroCliente, setFiltroCliente] = useState('todos');

      // carga inicial (clientes, historial, productos, config)
      useEffect(() => {
        cargarDatosIniciales();
      }, []);

      useEffect(() => {
        // cuando se autentica admin, recargar datos (si hace falta)
        if (autenticado) cargarDatosIniciales();
      }, [autenticado]);

      // ============================
      // FUNCIONES DE BACKEND (Sheets)
      // ============================
      const fetchJSON = async (url) => {
        const res = await fetch(url);
        return await res.json();
      };

      const cargarDatosIniciales = async () => {
        setCargandoDatos(true);
        try {
          // Configuraci√≥n
          try {
            const cfg = await fetchJSON(`${GOOGLE_SHEETS_API}?action=obtenerConfiguracion`);
            if (cfg && cfg.success) {
              setCONFIG({ numero_wimpy: (cfg.numero || DEFAULT_NUMERO_WIMPY) });
            } else {
              setCONFIG({ numero_wimpy: DEFAULT_NUMERO_WIMPY });
            }
          } catch (e) {
            console.warn('No se pudo cargar configuraci√≥n, usando default', e);
            setCONFIG({ numero_wimpy: DEFAULT_NUMERO_WIMPY });
          }

          // Clientes
          try {
            const c = await fetchJSON(`${GOOGLE_SHEETS_API}?action=obtenerClientes`);
            if (c && c.success) setCLIENTES_DB(c.clientes || []);
          } catch (e) { console.warn('clientes', e); }

          // Historial (entregas)
          try {
            const h = await fetchJSON(`${GOOGLE_SHEETS_API}?action=obtenerHistorial`);
            if (h && h.success) setHISTORIAL(h.historial || []);
          } catch (e) { console.warn('historial', e); }

          // Productos
          try {
            const p = await fetchJSON(`${GOOGLE_SHEETS_API}?action=obtenerProductos`);
            if (p && p.success) setPRODUCTOS_DB(p.productos || []);
          } catch (e) { console.warn('productos', e); }

          // Pedidos (opcional)
          try {
            const pd = await fetchJSON(`${GOOGLE_SHEETS_API}?action=obtenerPedidos`);
            if (pd && pd.success) setPEDIDOS_DB(pd.pedidos || []);
          } catch (e) { /* no es cr√≠tico */ }
        } catch (error) {
          console.error('Error cargando datos iniciales', error);
        }
        setCargandoDatos(false);
      };

      // ============================
      // UTILIDADES
      // ============================
      const limpiarTelefono = (tel) => {
        let limpio = (tel || '').toString().replace(/\s+/g, '').replace(/-/g, '').replace(/\./g,'');
        limpio = limpio.replace(/\(/g,'').replace(/\)/g,'');
        // quitar + si vino
        if (limpio.startsWith('+')) limpio = limpio.slice(1);
        // si empieza por 0 lo quitamos (opcional)
        if (limpio.startsWith('0')) limpio = limpio.slice(1);
        if (!limpio.startsWith('57')) {
          // asumimos Colombia
          limpio = '57' + limpio;
        }
        return '+' + limpio;
      };

      const soloNumeroParaWhatsApp = (tel) => {
        // formato sin + para wa.me
        let t = (tel || '').toString().replace(/\s+/g, '').replace(/-/g, '').replace(/\+/g, '');
        if (!t.startsWith('57')) t = '57' + t;
        return t;
      };

      const nombreMes = (m) => {
        const meses = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
        return meses[m];
      };

      // ============================
      // CONFIGURACI√ìN -> Guardar en Sheets
      // ============================
      const guardarNumeroWimpy = async () => {
        try {
          let limpio = numeroLimpioDeInput(CONFIG.numero_wimpy || DEFAULT_NUMERO_WIMPY);
          // quitar + si lo escribi√≥
          if (limpio.startsWith('+')) limpio = limpio.slice(1);
          if (!limpio.startsWith('57')) limpio = '57' + limpio;
          // persistir en sheets
          setCargando(true);
          const resp = await fetchJSON(`${GOOGLE_SHEETS_API}?action=guardarConfiguracion&numero=${encodeURIComponent(limpio)}`);
          if (resp && resp.success) {
            setCONFIG({ numero_wimpy: limpio });
            alert('‚úì N√∫mero de WhatsApp de Wimpy actualizado');
          } else {
            alert('No se pudo guardar la configuraci√≥n en Sheets');
          }
        } catch (e) {
          console.error(e);
          alert('Error guardando configuraci√≥n');
        } finally { setCargando(false); }
      };

      const numeroLimpioDeInput = (s) => {
        if (!s) return '';
        return s.toString().replace(/\s+/g,'').replace(/-/g,'').replace(/\+/g,'');
      };

      // ============================
      // PRODUCTOS CRUD (Sheets)
      // ============================
      const agregarProducto = async () => {
        if (!nuevoProducto.nombre || !nuevoProducto.precio) {
          alert('Completa nombre y precio');
          return;
        }
        setCargando(true);
        try {
          const resp = await fetchJSON(`${GOOGLE_SHEETS_API}?action=agregarProducto&nombre=${encodeURIComponent(nuevoProducto.nombre)}&precio=${encodeURIComponent(nuevoProducto.precio)}`);
          if (resp && resp.success) {
            alert('‚úì Producto agregado');
            setNuevoProducto({ nombre: '', precio: '' });
            await cargarDatosIniciales();
            setVistaAdmin('productos');
          } else {
            alert('Error al agregar producto');
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n');
        } finally { setCargando(false); }
      };

      const iniciarEdicionProducto = (p) => {
        setEditProductoId(p.id);
        setNuevoProducto({ nombre: p.nombre, precio: p.precio });
        // navegar a la vista productos (si no est√°)
        setVistaAdmin('productos');
      };

      const guardarEdicionProducto = async () => {
        if (!editProductoId || !nuevoProducto.nombre) {
          alert('Completa los datos');
          return;
        }
        setCargando(true);
        try {
          const resp = await fetchJSON(`${GOOGLE_SHEETS_API}?action=editarProducto&id=${encodeURIComponent(editProductoId)}&nombre=${encodeURIComponent(nuevoProducto.nombre)}&precio=${encodeURIComponent(nuevoProducto.precio)}`);
          if (resp && resp.success) {
            alert('‚úì Producto actualizado');
            setNuevoProducto({ nombre: '', precio: '' });
            setEditProductoId(null);
            await cargarDatosIniciales();
          } else {
            alert('Error al editar producto');
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n');
        } finally { setCargando(false); }
      };

      const eliminarProducto = async (id) => {
        if (!confirm('¬øEliminar este producto?')) return;
        setCargando(true);
        try {
          const resp = await fetchJSON(`${GOOGLE_SHEETS_API}?action=eliminarProducto&id=${encodeURIComponent(id)}`);
          if (resp && resp.success) {
            alert('‚úì Producto eliminado');
            await cargarDatosIniciales();
          } else {
            alert('Error al eliminar producto');
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n');
        } finally { setCargando(false); }
      };

      // ============================
      // PEDIDOS (Carrito -> registrarPedido en Sheets)
      // ============================
      const agregarAlCarrito = (producto) => {
        setCarrito(prev => {
          const copia = [...prev];
          const existe = copia.find(i => i.id === producto.id);
          if (existe) {
            existe.cantidad = (existe.cantidad || 1) + 1;
          } else {
            copia.push({ ...producto, cantidad: 1 });
          }
          return copia;
        });
      };

      const quitarDelCarrito = (id) => {
        setCarrito(prev => prev.filter(i => i.id !== id));
      };

      const cambiarCantidad = (id, cantidad) => {
        setCarrito(prev => prev.map(i => i.id === id ? { ...i, cantidad: cantidad } : i));
      };

      const totalCarrito = useMemo(() => {
        return carrito.reduce((s, p) => s + (parseFloat(p.precio || 0) * (p.cantidad || 1)), 0);
      }, [carrito]);

      // Verificaci√≥n por WhatsApp: abrimos WhatsApp con un texto de verificaci√≥n
      const abrirVerificacionWhatsApp = () => {
        const numero = soloNumeroParaWhatsApp(CONFIG.numero_wimpy || DEFAULT_NUMERO_WIMPY);
        const mensaje = encodeURIComponent(`Verificar mi n√∫mero para pedidos. Mi tel√©fono: ${telefono}`);
        // intentamos esquema whatsapp://, sino wa.me
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const appLink = `whatsapp://send?phone=${numero}&text=${mensaje}`;
        const webLink = `https://wa.me/${numero}?text=${mensaje}`;
        // abrir
        try {
          if (isIOS) {
            window.location.href = appLink;
            // si no lo abre, se queda en blanco; para fallback abrimos webLink despu√©s de delay
            setTimeout(() => { window.location.href = webLink; }, 1000);
          } else {
            // Android/PC
            window.open(webLink, '_blank');
          }
        } catch (e) {
          window.open(webLink, '_blank');
        }
      };

      // Registrar pedido: guarda en Sheets y abre WhatsApp con resumen de pedido
      const enviarPedido = async () => {
        if (!telefono) {
          alert('Ingresa tu n√∫mero de tel√©fono');
          return;
        }
        if (carrito.length === 0) {
          alert('Tu carrito est√° vac√≠o');
          return;
        }
        setCargando(true);
        try {
          // construir detalle
          const detalle = carrito.map(p => `${p.cantidad} x ${p.nombre}`).join(', ');
          const total = totalCarrito;
          // para registrar en Sheets, enviamos carrito serializado y tel√©fono
          // asumimos action=registrarPedido implementado en Apps Script
          const payload = `${encodeURIComponent(JSON.stringify(carrito))}`;
          const numeroCliente = limpiarTelefono(telefono); // con +
          const nombreCliente = (clienteValidado && clienteValidado.nombre) ? clienteValidado.nombre : '';

          const url = `${GOOGLE_SHEETS_API}?action=registrarPedido&telefono=${encodeURIComponent(numeroCliente)}&nombre=${encodeURIComponent(nombreCliente)}&pedido=${payload}&total=${encodeURIComponent(total)}&detalle=${encodeURIComponent(detalle)}`;

          const resp = await fetchJSON(url);
          if (resp && resp.success) {
            // abrir WhatsApp para confirmaci√≥n / notificaci√≥n a Wimpy
            const numeroW = soloNumeroParaWhatsApp(CONFIG.numero_wimpy || DEFAULT_NUMERO_WIMPY);
            const mensaje = encodeURIComponent(`Nuevo pedido:\nCliente: ${nombreCliente || telefono}\nTel: ${telefono}\nPedido: ${detalle}\nTotal: $${total.toLocaleString('es-CO')}`);
            // abrir WA (iOS/Android fallback)
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const appLink = `whatsapp://send?phone=${numeroW}&text=${mensaje}`;
            const webLink = `https://wa.me/${numeroW}?text=${mensaje}`;

            // mostrar vista de √©xito y vaciar carrito
            setCarrito([]);
            setVista('resultado');
            setDecisionLocal('pedido_enviado');

            // abrir WA despu√©s de 700ms para que el usuario vea el mensaje
            setTimeout(() => {
              try {
                if (isIOS) {
                  window.location.href = appLink;
                  setTimeout(() => { window.location.href = webLink; }, 1000);
                } else {
                  window.open(webLink, '_blank');
                }
              } catch (e) {
                window.open(webLink, '_blank');
              }
            }, 700);
          } else {
            alert('Error registrando pedido. Intenta de nuevo.');
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n al enviar pedido.');
        } finally {
          setCargando(false);
        }
      };

      // ============================
      // VALIDACI√ìN DE CLIENTE (igual que antes)
      // ============================
      const validarCliente = async () => {
        if (!telefono.trim()) {
          alert('Por favor ingresa tu n√∫mero de tel√©fono');
          return;
        }
        setCargando(true);
        try {
          const telefonoLimpio = limpiarTelefono(telefono); // con +
          const resp = await fetchJSON(`${GOOGLE_SHEETS_API}?action=validarCliente&telefono=${encodeURIComponent(telefonoLimpio)}`);
          if (resp && resp.success) {
            setClienteValidado(resp.cliente);
            // IR a la pantalla de men√∫/pedido en lugar de confirmaci√≥n
            setVista('menu');
          } else {
            setClienteValidado(null);
            // permitir crear pedido igualmente, pero sugerir registrar
            if (confirm('N√∫mero no registrado. ¬øDeseas continuar y hacer un pedido como invitado?')) {
              setVista('menu');
            } else {
              setVista('resultado');
              setDecisionLocal('no_registrado');
            }
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n. Por favor intenta nuevamente.');
        } finally {
          setCargando(false);
        }
      };

      // peque√±o estado para resultado (mantener compatibilidad)
      const [decisionLocal, setDecisionLocal] = useState(null);

      // ============================
      // ADMIN: Clientes (mantener funciones previas)
      // ============================
      const agregarCliente = async (nuevo) => {
        if (!nuevo.telefono || !nuevo.nombre) {
          alert('Completa tel√©fono y nombre');
          return;
        }
        setCargando(true);
        try {
          const telefonoLimpio = limpiarTelefono(nuevo.telefono);
          const url = `${GOOGLE_SHEETS_API}?action=agregarCliente&telefono=${encodeURIComponent(telefonoLimpio)}&nombre=${encodeURIComponent(nuevo.nombre)}&email=${encodeURIComponent(nuevo.email || '')}`;
          const resp = await fetchJSON(url);
          if (resp && resp.success) {
            alert('‚úì Cliente agregado exitosamente');
            await cargarDatosIniciales();
          } else {
            alert('Error al agregar cliente');
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n');
        } finally { setCargando(false); }
      };

      const toggleClienteActivo = async (clienteId) => {
        try {
          const url = `${GOOGLE_SHEETS_API}?action=toggleClienteActivo&clienteId=${clienteId}`;
          const resp = await fetchJSON(url);
          if (resp && resp.success) {
            await cargarDatosIniciales();
            setVistaAdmin('clientes');
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n');
        }
      };

      // ============================
      // ADMIN: Pedidos -> marcar entregado etc.
      // (si implementas acciones en Sheets)
      // ============================
      const actualizarEstadoPedido = async (pedidoId, nuevoEstado) => {
        try {
          const url = `${GOOGLE_SHEETS_API}?action=actualizarEstadoPedido&id=${encodeURIComponent(pedidoId)}&estado=${encodeURIComponent(nuevoEstado)}`;
          const resp = await fetchJSON(url);
          if (resp && resp.success) {
            await cargarDatosIniciales();
          } else {
            alert('Error actualizando estado');
          }
        } catch (e) {
          console.error(e);
          alert('Error de conexi√≥n');
        }
      };

      // ============================
      // AUTENTICACI√ìN ADMIN
      // ============================
      const iniciarSesionAdmin = () => {
        if (passwordInput === ADMIN_PASSWORD) {
          setAutenticado(true);
          setVista('admin');
          setPasswordInput('');
        } else {
          alert('‚ùå Contrase√±a incorrecta');
        }
      };

      const cerrarSesionAdmin = () => {
        setAutenticado(false);
        setVista('inicio');
        setVistaAdmin('dashboard');
      };

      const reiniciar = () => {
        setVista('inicio');
        setTelefono('');
        setClienteValidado(null);
        setDecisionLocal(null);
      };

      // ============================
      // RENDERS: VISTAS
      // ============================

      // -- Vista Admin Login
      if (vista === 'admin' && !autenticado) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-gray-800 via-gray-900 to-black flex items-center justify-center p-4">
            <div className="max-w-md w-full bg-white rounded-3xl shadow-2xl p-8">
              <div className="text-center mb-8">
                <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-full mb-4 text-4xl">üîí</div>
                <h1 className="text-2xl font-bold text-gray-800 mb-2">Acceso Administrador</h1>
                <p className="text-gray-600">Wimpy Restaurante</p>
              </div>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">üîë Contrase√±a</label>
                  <input
                    type="password"
                    value={passwordInput}
                    onChange={(e) => setPasswordInput(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && iniciarSesionAdmin()}
                    placeholder="Ingresa la contrase√±a"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                  />
                </div>
                <button onClick={iniciarSesionAdmin} className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-xl font-bold hover:from-orange-600 hover:to-red-600 transition-all shadow-lg">
                  Ingresar
                </button>
                <button onClick={reiniciar} className="w-full text-gray-600 py-2 text-sm hover:text-orange-600 transition-colors">‚Üê Volver</button>
              </div>
            </div>
          </div>
        );
      }

      // -- Admin panel
      if (vista === 'admin' && autenticado) {
        return (
          <div className="min-h-screen bg-gray-50">
            <div className="bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 shadow-lg">
              <div className="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
                <div className="flex items-center gap-3">
                  <span className="text-3xl">‚òï</span>
                  <div>
                    <h1 className="text-xl font-bold">Wimpy - Admin</h1>
                    <p className="text-xs opacity-90">Panel de Control</p>
                  </div>
                </div>
                <button onClick={cerrarSesionAdmin} className="flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all">üö™ Cerrar Sesi√≥n</button>
              </div>
            </div>

            <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
              <div className="max-w-7xl mx-auto px-4">
                <div className="flex gap-2 overflow-x-auto py-2">
                  <button onClick={() => setVistaAdmin('dashboard')} className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${vistaAdmin === 'dashboard' ? 'bg-orange-100 text-orange-700' : 'text-gray-600 hover:bg-gray-100'}`}>üìä Dashboard</button>
                  <button onClick={() => setVistaAdmin('configuracion')} className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${vistaAdmin === 'configuracion' ? 'bg-orange-100 text-orange-700' : 'text-gray-600 hover:bg-gray-100'}`}>‚öôÔ∏è Configuraci√≥n</button>
                  <button onClick={() => setVistaAdmin('clientes')} className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${vistaAdmin === 'clientes' ? 'bg-orange-100 text-orange-700' : 'text-gray-600 hover:bg-gray-100'}`}>üë• Clientes</button>
                  <button onClick={() => setVistaAdmin('productos')} className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${vistaAdmin === 'productos' ? 'bg-orange-100 text-orange-700' : 'text-gray-600 hover:bg-gray-100'}`}>üçî Productos</button>
                  <button onClick={() => setVistaAdmin('pedidos')} className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${vistaAdmin === 'pedidos' ? 'bg-orange-100 text-orange-700' : 'text-gray-600 hover:bg-gray-100'}`}>üìã Pedidos</button>
                  <button onClick={() => setVistaAdmin('reportes')} className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${vistaAdmin === 'reportes' ? 'bg-orange-100 text-orange-700' : 'text-gray-600 hover:bg-gray-100'}`}>üìà Reportes</button>
                  <button onClick={() => setVistaAdmin('factura')} className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-all ${vistaAdmin === 'factura' ? 'bg-orange-100 text-orange-700' : 'text-gray-600 hover:bg-gray-100'}`}>üí∞ Cuenta de Cobro</button>
                </div>
              </div>
            </div>

            <div className="max-w-7xl mx-auto p-4">
              {vistaAdmin === 'configuracion' && (
                <div className="space-y-6">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">‚öôÔ∏è Configuraci√≥n del Sistema</h2>
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                      <h3 className="font-bold text-blue-800 mb-2">üì± N√∫mero de WhatsApp de Wimpy</h3>
                      <p className="text-sm text-blue-700 mb-4">Este es el n√∫mero al que llegar√°n los mensajes de confirmaci√≥n y pedidos.</p>

                      <div className="space-y-3">
                        <input
                          type="text"
                          value={CONFIG.numero_wimpy || ''}
                          onChange={(e) => setCONFIG({...CONFIG, numero_wimpy: e.target.value})}
                          placeholder="3118336562"
                          className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-lg"
                        />
                        <div className="flex gap-2">
                          <button onClick={guardarNumeroWimpy} disabled={cargando} className="px-6 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600">‚úì Guardar</button>
                          <button onClick={() => { cargarDatosIniciales(); }} className="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400">Revertir</button>
                        </div>
                      </div>
                    </div>

                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                      <h3 className="font-bold text-yellow-800 mb-2">‚ö†Ô∏è Importante</h3>
                      <ul className="text-sm text-yellow-700 space-y-1">
                        <li>‚Ä¢ Todos los cambios de configuraci√≥n se guardan en Google Sheets.</li>
                        <li>‚Ä¢ El n√∫mero se usa para abrir WhatsApp desde el cliente.</li>
                      </ul>
                    </div>
                  </div>
                </div>
              )}

              {vistaAdmin === 'productos' && (
                <div className="space-y-6">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span>‚ûï</span> Agregar / Editar Producto</h2>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                      <input type="text" placeholder="Nombre del producto" value={nuevoProducto.nombre} onChange={(e) => setNuevoProducto({...nuevoProducto, nombre: e.target.value})} className="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                      <input type="number" placeholder="Precio" value={nuevoProducto.precio} onChange={(e) => setNuevoProducto({...nuevoProducto, precio: e.target.value})} className="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
                    </div>

                    <div className="flex gap-2">
                      {editProductoId ? (
                        <>
                          <button onClick={guardarEdicionProducto} disabled={cargando} className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700">üíæ Guardar cambios</button>
                          <button onClick={() => { setEditProductoId(null); setNuevoProducto({nombre:'',precio:''}); }} className="px-6 py-3 bg-gray-300 rounded-lg">Cancelar</button>
                        </>
                      ) : (
                        <button onClick={agregarProducto} disabled={cargando} className="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg font-semibold hover:from-green-600">+ Agregar Producto</button>
                      )}
                    </div>
                  </div>

                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Productos Registrados ({PRODUCTOS_DB.length})</h2>

                    {cargandoDatos ? (
                      <div className="text-center py-8"><p className="text-gray-500">Cargando productos...</p></div>
                    ) : (
                      <div className="space-y-2">
                        {PRODUCTOS_DB.map((p) => (
                          <div key={p.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div>
                              <p className="font-semibold text-gray-800">{p.nombre}</p>
                              <p className="text-sm text-gray-500">${Number(p.precio).toLocaleString('es-CO')}</p>
                            </div>
                            <div className="flex gap-2">
                              <button onClick={() => iniciarEdicionProducto(p)} className="px-3 py-1 bg-blue-500 text-white rounded-lg">‚úèÔ∏è</button>
                              <button onClick={() => eliminarProducto(p.id)} className="px-3 py-1 bg-red-500 text-white rounded-lg">üóëÔ∏è</button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              )}

              {vistaAdmin === 'pedidos' && (
                <div className="space-y-6">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">üìã Pedidos</h2>
                    {PEDIDOS_DB.length === 0 ? (
                      <div className="text-center py-8"><p className="text-gray-500">No hay pedidos registrados</p></div>
                    ) : (
                      <div className="space-y-3">
                        {PEDIDOS_DB.slice().reverse().map(p => (
                          <div key={p.id} className="p-4 bg-gray-50 rounded-lg border border-gray-200 flex items-start justify-between">
                            <div className="flex-1">
                              <p className="font-semibold text-gray-800">Cliente: {p.nombre || p.telefono}</p>
                              <p className="text-sm text-gray-600">Tel: {p.telefono}</p>
                              <p className="text-sm text-gray-700 mt-2">Pedido: {p.detalle}</p>
                              <p className="text-sm text-gray-600 mt-1">Total: ${Number(p.total).toLocaleString('es-CO')}</p>
                              <p className="text-xs text-gray-500 mt-1">Fecha: {p.fecha || ''} {p.hora || ''}</p>
                            </div>
                            <div className="flex flex-col gap-2">
                              <select value={p.estado || 'pendiente'} onChange={(e) => actualizarEstadoPedido(p.id, e.target.value)} className="px-3 py-2 border rounded-lg">
                                <option value="pendiente">Pendiente</option>
                                <option value="en_preparacion">En preparaci√≥n</option>
                                <option value="enviado">Enviado</option>
                                <option value="entregado">Entregado</option>
                              </select>
                              <button onClick={() => window.open(`https://wa.me/${soloNumeroParaWhatsApp(CONFIG.numero_wimpy || DEFAULT_NUMERO_WIMPY)}?text=${encodeURIComponent('Detalle pedido: ' + p.detalle + ' - Cliente: ' + (p.nombre || p.telefono))}`, '_blank')} className="px-3 py-2 bg-orange-500 text-white rounded-lg">Abrir en WhatsApp</button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Mantengo dashboard, clientes, reportes y factura (similar al original). */}
              {vistaAdmin === 'dashboard' && (
                <div className="space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div className="bg-white rounded-xl p-5 shadow-md border border-gray-200">
                      <div className="flex items-center justify-between mb-2">
                        <p className="text-sm text-gray-600 font-semibold">Total Entregas</p>
                        <span className="text-3xl">üì¶</span>
                      </div>
                      <p className="text-3xl font-bold text-blue-700">{HISTORIAL.length}</p>
                    </div>
                    <div className="bg-white rounded-xl p-5 shadow-md border border-gray-200">
                      <div className="flex items-center justify-between mb-2">
                        <p className="text-sm text-gray-600 font-semibold">Pedidos</p>
                        <span className="text-3xl">üßæ</span>
                      </div>
                      <p className="text-3xl font-bold text-green-700">{PEDIDOS_DB.length}</p>
                    </div>
                    <div className="bg-white rounded-xl p-5 shadow-md border border-gray-200">
                      <div className="flex items-center justify-between mb-2">
                        <p className="text-sm text-gray-600 font-semibold">Productos</p>
                        <span className="text-3xl">üçî</span>
                      </div>
                      <p className="text-3xl font-bold text-orange-700">{PRODUCTOS_DB.length}</p>
                    </div>
                    <div className="bg-white rounded-xl p-5 shadow-md border border-gray-200">
                      <div className="flex items-center justify-between mb-2">
                        <p className="text-sm text-gray-600 font-semibold">Clientes</p>
                        <span className="text-3xl">üë•</span>
                      </div>
                      <p className="text-3xl font-bold text-indigo-700">{CLIENTES_DB.length}</p>
                    </div>
                  </div>
                </div>
              )}

              {vistaAdmin === 'clientes' && (
                <div className="space-y-6">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">‚ûï Agregar Nuevo Cliente</h2>
                    <AgregarClienteForm onAdd={agregarCliente} />
                  </div>

                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Clientes Registrados ({CLIENTES_DB.length})</h2>
                    {cargandoDatos ? (
                      <div className="text-center py-8"><p className="text-gray-500">Cargando clientes...</p></div>
                    ) : (
                      <div className="space-y-2">
                        {CLIENTES_DB.map((cliente) => (
                          <div key={cliente.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100">
                            <div>
                              <p className="font-semibold text-gray-800">{cliente.nombre}</p>
                              <p className="text-sm text-gray-600">{cliente.telefono}</p>
                              {cliente.email && <p className="text-xs text-gray-500">{cliente.email}</p>}
                            </div>
                            <button onClick={() => toggleClienteActivo(cliente.id)} className={`px-4 py-2 rounded-lg font-semibold text-sm ${cliente.activo ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-600'}`}>{cliente.activo ? '‚úì Activo' : '‚úó Inactivo'}</button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              )}

              {vistaAdmin === 'reportes' && (
                <div className="space-y-6">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Filtros de B√∫squeda</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Mes</label>
                        <select value={filtroMes} onChange={(e) => setFiltroMes(parseInt(e.target.value))} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                          {Array.from({length:12},(_,i)=> <option key={i} value={i}>{nombreMes(i)}</option>)}
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">A√±o</label>
                        <select value={filtroAnio} onChange={(e) => setFiltroAnio(parseInt(e.target.value))} className="w-full px-4 py-3 border border-gray-300 rounded-lg">
                          <option value={2024}>2024</option><option value={2025}>2025</option><option value={2026}>2026</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Cliente</label>
                        <select value={filtroCliente} onChange={(e) => setFiltroCliente(e.target.value)} className="w-full px-4 py-3 border border-gray-300 rounded-lg">
                          <option value="todos">Todos los clientes</option>
                          {CLIENTES_DB.map(c => <option key={c.id} value={c.id}>{c.nombre}</option>)}
                        </select>
                      </div>
                    </div>
                  </div>

                  <div className="bg-gradient-to-r from-orange-500 to-red-500 rounded-xl shadow-md p-6 text-white">
                    <h3 className="text-2xl font-bold mb-2">{nombreMes(filtroMes)} {filtroAnio}</h3>
                    <p className="text-3xl font-bold">{HISTORIAL.filter(h => h.mes === filtroMes && h.anio === filtroAnio && h.decision === 'aceptado').length} almuerzos entregados</p>
                    <p className="text-sm opacity-90 mt-2">Solo almuerzos aceptados (no se cuentan cancelados)</p>
                  </div>
                </div>
              )}

              {vistaAdmin === 'factura' && (
                <div className="space-y-6">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Generar Cuenta de Cobro</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                      <div><label className="block text-sm font-semibold text-gray-700 mb-2">#Ô∏è‚É£ N√∫mero de Cuenta de Cobro</label><input type="text" value={datosFactura.numeroFactura} onChange={(e) => setDatosFactura({...datosFactura, numeroFactura: e.target.value})} className="w-full px-4 py-3 border border-gray-300 rounded-lg"/></div>
                      <div><label className="block text-sm font-semibold text-gray-700 mb-2">üè¢ Empresa Cliente</label><input type="text" value={datosFactura.empresaCliente} onChange={(e) => setDatosFactura({...datosFactura, empresaCliente: e.target.value})} className="w-full px-4 py-3 border border-gray-300 rounded-lg"/></div>
                      <div><label className="block text-sm font-semibold text-gray-700 mb-2">üìÖ Mes de Cobro</label><select value={datosFactura.mesFactura} onChange={(e)=> setDatosFactura({...datosFactura, mesFactura: parseInt(e.target.value)})} className="w-full px-4 py-3 border border-gray-300 rounded-lg">{Array.from({length:12},(_,i)=> <option key={i} value={i}>{nombreMes(i)}</option>)}</select></div>
                      <div><label className="block text-sm font-semibold text-gray-700 mb-2">üìÖ A√±o de Cobro</label><select value={datosFactura.anioFactura} onChange={(e)=> setDatosFactura({...datosFactura, anioFactura: parseInt(e.target.value)})} className="w-full px-4 py-3 border border-gray-300 rounded-lg"><option value={2024}>2024</option><option value={2025}>2025</option><option value={2026}>2026</option></select></div>
                      <div><label className="block text-sm font-semibold text-gray-700 mb-2">üíµ Valor por Almuerzo (COP)</label><input type="number" value={datosFactura.valorAlmuerzo} onChange={(e)=> setDatosFactura({...datosFactura, valorAlmuerzo: e.target.value})} className="w-full px-4 py-3 border border-gray-300 rounded-lg"/></div>
                      <div><label className="block text-sm font-semibold text-gray-700 mb-2">üìÖ Fecha de Emisi√≥n</label><input type="date" value={datosFactura.fechaEmision} onChange={(e)=> setDatosFactura({...datosFactura, fechaEmision: e.target.value})} className="w-full px-4 py-3 border border-gray-300 rounded-lg"/></div>
                    </div>
                    <button onClick={() => { if(!datosFactura.numeroFactura||!datosFactura.empresaCliente||!datosFactura.valorAlmuerzo){alert('Por favor completa todos los campos requeridos'); return;} window.print(); }} className="w-full md:w-auto px-8 py-4 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl font-bold">üñ®Ô∏è Generar e Imprimir</button>
                  </div>

                  {datosFactura.numeroFactura && datosFactura.empresaCliente && datosFactura.valorAlmuerzo && (
                    <div id="cuenta-cobro" className="bg-white rounded-xl shadow-2xl p-8 border-2 border-gray-300">
                      {/* contenido de cuenta de cobro similar al original */}
                      <div className="text-center mb-8 pb-6 border-b-2 border-orange-500">
                        <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-full mb-4 text-4xl">‚òï</div>
                        <h1 className="text-3xl font-bold text-gray-800 mb-1">Wimpy</h1>
                        <p className="text-lg text-orange-600 font-semibold">Restaurante y Cafeter√≠a</p>
                      </div>
                      <div className="text-center mb-8">
                        <h2 className="text-2xl font-bold text-gray-800 mb-2">CUENTA DE COBRO</h2>
                        <p className="text-lg text-gray-600">No. {datosFactura.numeroFactura}</p>
                        <p className="text-sm text-gray-500">Fecha: {new Date(datosFactura.fechaEmision).toLocaleDateString('es-CO', {day:'2-digit', month:'long', year:'numeric'})}</p>
                      </div>
                      <div className="mb-8 bg-gray-50 rounded-lg p-6">
                        <h3 className="font-bold text-gray-800 mb-3 text-lg">CLIENTE:</h3>
                        <p className="text-xl font-semibold text-gray-800">{datosFactura.empresaCliente}</p>
                      </div>
                      <div className="mb-8">
                        <h3 className="font-bold text-gray-800 mb-4 text-lg">DETALLE DEL SERVICIO:</h3>
                        <table className="w-full border-collapse">
                          <thead>
                            <tr className="bg-orange-100">
                              <th className="border border-gray-300 px-4 py-3 text-left font-semibold text-gray-800">Descripci√≥n</th>
                              <th className="border border-gray-300 px-4 py-3 text-center font-semibold text-gray-800">Cantidad</th>
                              <th className="border border-gray-300 px-4 py-3 text-right font-semibold text-gray-800">Valor Unit.</th>
                              <th className="border border-gray-300 px-4 py-3 text-right font-semibold text-gray-800">Total</th>
                            </tr>
                          </thead>
                          <tbody>
                            {(() => {
                              const entregas = HISTORIAL.filter(h => h.mes === datosFactura.mesFactura && h.anio === datosFactura.anioFactura && h.decision === 'aceptado');
                              const cantidad = entregas.length;
                              const valorUnit = parseFloat(datosFactura.valorAlmuerzo) || 0;
                              const total = cantidad * valorUnit;
                              return (
                                <tr>
                                  <td className="border border-gray-300 px-4 py-3">
                                    <p className="font-semibold">Servicio de Almuerzos</p>
                                    <p className="text-sm text-gray-600">Per√≠odo: {nombreMes(datosFactura.mesFactura)} {datosFactura.anioFactura}</p>
                                  </td>
                                  <td className="border border-gray-300 px-4 py-3 text-center text-lg font-bold">{cantidad}</td>
                                  <td className="border border-gray-300 px-4 py-3 text-right">${valorUnit.toLocaleString('es-CO')}</td>
                                  <td className="border border-gray-300 px-4 py-3 text-right text-lg font-bold text-orange-600">${total.toLocaleString('es-CO')}</td>
                                </tr>
                              );
                            })()}
                          </tbody>
                        </table>
                      </div>
                      <div className="bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg p-6 mb-8">
                        <div className="flex items-center justify-between">
                          <span className="text-2xl font-bold">TOTAL A PAGAR:</span>
                          <span className="text-4xl font-bold">${(() => {
                            const entregas = HISTORIAL.filter(h => h.mes === datosFactura.mesFactura && h.anio === datosFactura.anioFactura && h.decision === 'aceptado');
                            const cantidad = entregas.length;
                            const valorUnit = parseFloat(datosFactura.valorAlmuerzo) || 0;
                            return (cantidad * valorUnit).toLocaleString('es-CO');
                          })()}</span>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      }

      // -- Vista Cliente: Inicio
      if (vista === 'inicio') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 flex items-center justify-center p-4">
            <div className="max-w-md w-full">
              <div className="bg-white rounded-3xl shadow-2xl p-8">
                <div className="text-center mb-8">
                  <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-full mb-4 shadow-lg text-4xl">‚òï</div>
                  <h1 className="text-3xl font-bold text-gray-800 mb-1">Wimpy</h1>
                  <p className="text-orange-600 font-semibold mb-3">Restaurante y Cafeter√≠a</p>
                  <div className="w-16 h-1 bg-gradient-to-r from-orange-500 to-red-500 mx-auto rounded-full mb-4"></div>
                  <p className="text-gray-600 text-sm">Haz tu pedido o confirma la entrega</p>
                </div>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">üì± N√∫mero de WhatsApp</label>
                    <input type="tel" value={telefono} onChange={(e) => setTelefono(e.target.value)} placeholder="3118336562" className="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 text-lg transition-all" disabled={cargando}/>
                    <p className="text-xs text-gray-500 mt-2">üí° Ejemplo: 3118336562 o 57 3118336562</p>
                  </div>
                  <div className="grid grid-cols-1 gap-3">
                    <button onClick={validarCliente} disabled={!telefono || cargando} className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-lg hover:from-orange-600 hover:to-red-600 transition-all shadow-lg">{cargando ? '‚è≥ Validando...' : 'üçî Continuar'}</button>
                    <button onClick={() => setVista('admin')} className="w-full text-gray-500 py-3 text-sm hover:text-orange-600 transition-colors">üîí Panel de Administraci√≥n</button>
                  </div>
                </div>
              </div>
              <div className="text-center mt-4 text-gray-500 text-xs">üîí Tus datos est√°n protegidos</div>
            </div>
          </div>
        );
      }

      // -- Vista Menu/Pedido (despu√©s de validar o continuar)
      if (vista === 'menu') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 p-4">
            <div className="max-w-md mx-auto">
              <div className="bg-white rounded-3xl shadow-2xl p-6 mb-4">
                <div className="flex items-center gap-3">
                  <div className="inline-flex items-center justify-center w-14 h-14 bg-gradient-to-br from-orange-500 to-red-500 rounded-full text-2xl">‚òï</div>
                  <div>
                    <h2 className="text-xl font-bold">{clienteValidado ? `Hola ${clienteValidado.nombre}` : 'Hola'}</h2>
                    <p className="text-sm text-gray-600">Selecciona los productos y haz tu pedido</p>
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-xl shadow-md p-4 mb-4">
                <h3 className="font-semibold text-gray-800 mb-3">Men√∫</h3>
                {PRODUCTOS_DB.length === 0 ? (
                  <div className="text-center py-8 text-gray-500">No hay productos disponibles</div>
                ) : (
                  <div className="space-y-3">
                    {PRODUCTOS_DB.filter(p => p.activo === true || p.activo === 'TRUE' || p.activo === 'true').map(p => (
                      <div key={p.id} className="flex items-center justify-between p-3 border border-gray-100 rounded-lg">
                        <div>
                          <p className="font-semibold">{p.nombre}</p>
                          <p className="text-sm text-gray-500">${Number(p.precio).toLocaleString('es-CO')}</p>
                        </div>
                        <div className="flex items-center gap-2">
                          <button onClick={() => agregarAlCarrito(p)} className="px-3 py-2 bg-orange-500 text-white rounded-lg">+ A√±adir</button>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <div className="bg-white rounded-xl shadow-md p-4 mb-4">
                <h3 className="font-semibold text-gray-800 mb-3">Tu carrito</h3>
                {carrito.length === 0 ? (
                  <div className="text-center text-gray-500 py-6">Tu carrito est√° vac√≠o</div>
                ) : (
                  <div className="space-y-3">
                    {carrito.map(item => (
                      <div key={item.id} className="flex items-center justify-between p-3 border border-gray-100 rounded-lg">
                        <div>
                          <p className="font-semibold">{item.nombre}</p>
                          <p className="text-sm text-gray-500">Cantidad:
                            <input type="number" min="1" value={item.cantidad} onChange={(e) => cambiarCantidad(item.id, Math.max(1, Number(e.target.value)))} className="w-16 ml-2 px-2 py-1 border rounded-md"/>
                          </p>
                        </div>
                        <div className="text-right">
                          <p className="font-semibold">${(Number(item.precio) * item.cantidad).toLocaleString('es-CO')}</p>
                          <button onClick={() => quitarDelCarrito(item.id)} className="text-xs text-red-600 mt-1">Eliminar</button>
                        </div>
                      </div>
                    ))}
                    <div className="flex items-center justify-between pt-3 border-t">
                      <p className="font-semibold">Total</p>
                      <p className="text-xl font-bold">${Number(totalCarrito).toLocaleString('es-CO')}</p>
                    </div>
                  </div>
                )}
              </div>

              <div className="space-y-3">
                <div className="bg-white rounded-xl shadow-md p-4">
                  <p className="text-sm text-gray-600 mb-2">Antes de enviar: verifica tu n√∫mero v√≠a WhatsApp</p>
                  <div className="flex gap-2">
                    <button onClick={abrirVerificacionWhatsApp} className="flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg">üì≤ Verificar en WhatsApp</button>
                    <button onClick={() => { if (confirm('Continuar sin verificar?')) enviarPedido(); }} disabled={cargando} className="flex-1 px-4 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg">{cargando ? 'Enviando...' : 'üõí Enviar pedido'}</button>
                  </div>
                </div>

                <button onClick={() => { setVista('inicio'); setCarrito([]); }} className="w-full text-gray-600 py-3 rounded-lg border">‚Üê Volver</button>
              </div>
            </div>
          </div>
        );
      }

      // -- Vista resultado (varios tipos)
      if (vista === 'resultado') {
        if (decisionLocal === 'no_registrado') {
          return (
            <div className="min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-amber-50 flex items-center justify-center p-4">
              <div className="max-w-md w-full">
                <div className="bg-white rounded-3xl shadow-2xl p-8 text-center">
                  <div className="inline-flex items-center justify-center w-20 h-20 bg-red-100 rounded-full mb-6 text-4xl">‚ö†Ô∏è</div>
                  <h2 className="text-2xl font-bold text-gray-800 mb-3">N√∫mero no registrado</h2>
                  <p className="text-gray-600 mb-6">El n√∫mero {telefono} no est√° registrado en Wimpy.</p>
                  <button onClick={() => setVista('inicio')} className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl">Intentar nuevamente</button>
                </div>
              </div>
            </div>
          );
        }

        if (decisionLocal === 'pedido_enviado') {
          return (
            <div className="min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 flex items-center justify-center p-4">
              <div className="max-w-md w-full">
                <div className="bg-white rounded-3xl shadow-2xl p-8 text-center">
                  <div className="inline-flex items-center justify-center w-24 h-24 bg-green-100 rounded-full mb-6 text-5xl">‚úÖ</div>
                  <h2 className="text-3xl font-bold text-gray-800 mb-3">¬°Pedido enviado! üéâ</h2>
                  <p className="text-gray-600 mb-6">Tu pedido fue registrado y se abri√≥ WhatsApp para notificar a Wimpy.</p>
                  <button onClick={() => { setVista('inicio'); setDecisionLocal(null); }} className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl">‚úì Finalizar</button>
                </div>
              </div>
            </div>
          );
        }

        return null;
      }

      return null;
    }

    // ============================
    // COMPONENTES AUXILIARES
    // ============================
    function AgregarClienteForm({ onAdd }) {
      const [data, setData] = React.useState({ telefono:'', nombre:'', email:'' });
      return (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input type="tel" placeholder="Tel√©fono (3118336562)" value={data.telefono} onChange={(e)=> setData({...data, telefono:e.target.value})} className="px-4 py-3 border border-gray-300 rounded-lg"/>
          <input type="text" placeholder="Nombre completo" value={data.nombre} onChange={(e)=> setData({...data, nombre:e.target.value})} className="px-4 py-3 border border-gray-300 rounded-lg"/>
          <input type="email" placeholder="Email (opcional)" value={data.email} onChange={(e)=> setData({...data, email:e.target.value})} className="px-4 py-3 border border-gray-300 rounded-lg"/>
          <div className="md:col-span-3">
            <button onClick={() => { onAdd(data); setData({telefono:'',nombre:'',email:''}); }} className="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg">+ Agregar Cliente</button>
          </div>
        </div>
      );
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>